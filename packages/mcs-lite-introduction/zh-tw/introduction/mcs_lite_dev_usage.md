# MCS Lite 開發者介面使用說明

## 連線 MCS Lite 本地端服務器

如何連線，連線協定

## 產品原型

### 何謂產品原型？

產品原型（Prototype）是您開發與設計裝置的藍圖。其中包含了

* **資料通道（Data Channel）**  
  裝置與 MCS Lite 之間的指令與數據傳遞是透過資料通道來定義的。資料通道有以下兩種類型：

* * 顯示器：由裝置的感應元件蒐集而回傳到 MCS Lite 的數據。
* * 控制器：透過 MCS Lite 傳送給裝置的指令或數據。

為了能顯示及處理不同類型的數據，MCS Lite 提供以下幾種型態的資料通道：

* * 開關（On/Off）— 用來顯示/操作裝置的開機與關機兩種狀態。
* * 整數（Integer）— 用來顯示/設定任意的整數，例如顯示使用者一天走了多少步數。
* * 浮點數（Float）— 用來顯示/設定任意的浮點數，例如設定空調設備的溫度。
* * 字串（String）— 用來顯示/設定任意的字串，例如顯示裝置當前韌體版本或時間。
* * 十六進位數（Hex）— 用來顯示/設定任意的十六進位數值，例如設定 LED 燈的顯示顏色。
* * GPIO — 用來顯示/設定 GPIO 的數位訊號。例如設定 Pin 4 角位為 High。
* * PWM — 用來顯示/設定傳遞到 GPIO 的 PWM 數位訊號, 例如在 Pin 3 位置的 level 15 訊號。
* * 類比（Analog）— 此類型的資料型態所代表的是一個整數，其數值的區間需由使用者自行定義。類比控制器適合需要微調或是比例控制等應用，像是音量控制器。
* * 類別（Category）— 用來表示一個任意的類別。您能定義任何您想要的類別和此類別相對的內容。例如您能用來儲存星期，月份，或是風扇的狀態（關、慢速、中速、高速）。
* **觸發條件**

MCS Lite 支援發送一個觸發訊息（Webhook）到您所設定的任何一個雲端平台，當某一個資料通道的數值等於，超過，低於或是介於設定值，將會觸發 Webhook。同時數據仍會被保存。

您可以在設定觸發訊息時使用 **${} **來帶入變數。變數包括 ${deviceId}、${deviceName}、${value}。這些變數會被放入 Webhook 請求的內文（Request Body）當中。

### 如何建立產品原型？

您可透過以下三種方法來建立您的產品原型

* 自行設定
  1. 點擊畫面上方的**開發**連結，並選擇**產品原型**。
  2. 點擊**創建**按鈕。
  3. 輸入產品原型名稱，版本，並選擇硬體平台後點擊**儲存**按鈕。您的產品原型已建立。
  4. 點擊您剛建立的產品原型內的**詳情**按鈕則可以開始建立資料通道，觸發條件並且新增測試裝置了。
* 匯入 JSON 檔案
* 1. 點擊畫面上方的**開發**連結，並選擇**產品原型**。
  2. 點擊**創建**按鈕。
  3. 選擇**匯入 JSON 檔**。
  4. 您可貼上或是**瀏覽上傳** JSON 檔案。如何取得/匯出產品原型 JSON 檔案，請參考？？？
* 匯入教學範例
* 1. ?
  2. ?
  3. ?
  4. ?

## 測試裝置

### 何謂測試裝置？

如果說產品原型（Prototype）是您開發與設計裝置的藍圖，測試裝置則是對應到一個個實體的設備。

您已完成建立產品原型與設定資料通道，然而，在開始收集數據或操作實體設備之前，您必須在產品原型下建立對應的測試裝置，每一個測試裝置都會有一組 **DeviceId **和 **DeviceKey**，當您要將實體設備產生的數據回傳到 MCS Lite 時，則可透過在回傳訊息中指定裝置的 ID 與 key 將資料儲存到對應的測試裝置中。

您可以在 產品原型詳情頁面 -&gt; 測試裝置底下，查看此原型底下所有的測試裝置，或選取特定測試裝置來觀看其收集的數據或進行遠端操控。您亦可以修改其觸發條件或查看關於這個裝置的詳細資訊。

### 如何建立測試裝置？

#### 在 MCS Lite 上建立測試裝置

1. 點選產品原型的**詳情**按鈕。
2. 點選畫面右上方的**創建測試裝置**按鈕。
3. 在創建測試裝置對話窗中，輸入測試裝置名稱和描述，然後點擊**確定**按鈕。
4. 在創建成功的訊息對話窗中，您可以直接點擊**詳細資料**按鈕進入測試裝置頁面，或在產品原型詳情頁面中的測試裝置分頁內查看屬於此產品原型的測試裝置。

#### 設定實體設備與 MCS Lite 的連線

##### MQTT

要將實體設備連接上 MCS Lite 進行**雙向溝通**需要透過 **MQTT 協定**。裝置與 MCS Lite 平台相連之後，您可以透過電腦或是手機將指令發送給裝置，或是接收裝置上傳的數據。

MQTT 是一種雙向的輕量級訂閱和發佈通訊協定。您可以在此[連結](http://mqtt.org/)中查看更多關於 MQTT 通訊的資訊。MCS 採用標準的 MQTT 通訊模式，並且支援多種 MQTT 特色功能，包括離線訊息與保留訊息。

當連上 MCS Lite MQTT 伺服器後，便可以開始訂閱（subscribe）或是發佈（Publish）特定的主題（Topic）了。在 MCS Lite 中，**主題**指的是所要操作的資料通道。

###### 設定連線：

* MCS Lite MQTT 伺服器： ？？
* 連接埠： 1883\(未加密\) 或 8883\(加密\)，請注意，當您使用加密埠時，MCS 使用伺服器端加密方式。
* QoS \(Quality of Service\)： 0（只送一次，不保證訊息的成功傳達與否） 或 1（傳送至少一次，此種傳遞模式確保訊息一定會被傳達）
* 保持連線（Keep Alive Interval）：60 秒（保持連線為實體設備在一定的時間區間內，定期發送訊息至伺服器端以保持連線。）

更多 MQTT 訂閱與發佈的詳請，請參考下節的說明。

##### RESTful API

MCS Lite 也支援透過 HTTP 協定將數據回傳到伺服器端，如果您的實體設備只需要上傳數據，不需要與 MCS Lite 伺服器保持連線來接收指令，您也可以考慮這種方式。

###### 設定連線：

* MCS Lite HTTP 伺服器： ？？
* 連接埠：

更多 HTTP 上傳數據的詳請，請參考下節的說明。

### 設備如何上傳或接收數據與指令？

##### MQTT

###### 訂閱與發佈：

當您連結上 MCS MQTT 伺服器後，您可以訂閱整個裝置或是個別資料通道的訊息；或是發佈訊息至特定資料通道

當要**訂閱**特定資料通道時，訂閱主題的格式如下：

```
mcs/:deviceId/:deviceKey/:dataChnId
```

或是可**訂閱**特定裝置下全部資料通道：

```
mcs/:deviceId/:deviceKey/+
```

當要**發佈**時, 發佈主題的格式如下：

```
mcs/:deviceId/:deviceKey/:dataChnId
```

###### 溝通格式：

以下格式為您訂閱主題時會收到的訊息內容，或是發佈時亦是使用此相同格式：

```
timestamp,dataChnId,value
```

若要查看更多關於 MQTT 資料格式，您可以參考此[連結](https://mcs.mediatek.com/resources/zh-TW/latest/api_references/#mqtt-溝通格式)。

##### RESTful API

### 



